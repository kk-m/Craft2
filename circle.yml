machine:
    environment:
        ANDROID_HOME: /usr/local/android-sdk-linux
        JAVA_OPTS: "-Xmx2048m -XX:MaxPermSize=1024m"

dependencies:
    pre:
        # toolsをアップデート
        - echo y | android update sdk --no-ui --all --filter "platform-tools,tools"

        # SDKとビルドツールのインストール
        - echo y | android update sdk --no-ui --all --filter "android-22,build-tools-22.0.0"

        # 全角スペースがコメントでもだめみたい https://circleci.com/gh/kk-m/Craft2/29
        # Could not find com.android.support:appcompat-v7:22.2.1.のため下記を追加

        # supportライブラリをインストールするために必要
        - echo y | android update sdk --no-ui --all --filter "extra-android-m2repository"
        - echo y | android update sdk --no-ui --all --filter "extra-android-support"

        # appcompat-v7以降を使っている場合に必要 じゃなかった
        # - echo y | android update lib-project --path ./appcompat --target android-22
        # - echo y | android update project --path ./core --library ../appcompat --target android-22

        # successのときはメールこない


test:
    pre:
        # エミュレータを起動
        - $ANDROID_HOME/tools/emulator -avd test-target -no-skin -no-audio -no-window -no-boot-anim:
            background: true
            parallel: true
    override:
        - ./gradlew assembleDebug

        # エミュレータに対してテストを実行
        # - ./gradlew connectedAndroidTest

        # アーティファクトにビルド出力をコピー
        # - cp -r my-project/build/outputs $CIRCLE_ARTIFACTS

        # テスト結果ディレクトリにテスト結果をコピー
        # - cp -r my-project/build/outputs/androidTest-results/* $CIRCLE_TEST_REPORTS



